/****** Object:  View [dbo].[ZEB_NO_BankReconsileView_NotPayment]    Script Date: 01-06-2016 05:20:10 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER VIEW [dbo].[ZEB_NO_BankReconsileView_NotPayment] AS
SELECT
      '1920' as [Fixed number]
	  ,convert(date, [Accounting date]) as Date
	  ,(case when [Stores]<>'' then [Stores] else [Bank account] end) as [Store Id]
      	  ,[Amount transaction currency] as amount
      	  --,[TransType] as transtype
	  ,TEXT as [Description]
	  , [Legal Entity] as [Legal Entity]
  FROM [TSTPROJ4_AX2012].[dbo].[ZEB_GeneralJournalEntryView]
  where [TransType] <> '15 payment'

GO

ALTER VIEW [dbo].[ZEB_NO_BankReconsileView_Payments] AS
SELECT
      '1920' as [Fixed number]
	  ,convert(date, [Accounting date]) as Date
	  ,[Stores] as [Store Id]
      	  ,sum([Amount transaction currency]) as amount
      	  --,[TransType] as transtype
	  ,'BAX' as [Description]  
	  , [Legal Entity] as [Legal Entity]
  FROM [TSTPROJ4_AX2012].[dbo].[ZEB_GeneralJournalEntryView]
  where [TransType] = '15 payment'
  group by [Accounting date]
      ,[Stores]
      ,[TransType]
     ,[Legal Entity]
GO	 

ALTER VIEW [dbo].[ZEB_GeneralJournalEntryView]
AS
SELECT  dbo.SUBLEDGERVOUCHERGENERALJOURNALENTRY.VOUCHERDATAAREAID AS [Legal entity], 
		dbo.SUBLEDGERVOUCHERGENERALJOURNALENTRY.VOUCHER AS Voucher, 
		dbo.GENERALJOURNALACCOUNTENTRY.TEXT AS Description, 
          dbo.GENERALJOURNALACCOUNTENTRY.POSTINGTYPE AS [Posting type], 
		  dbo.GENERALJOURNALENTRY.ACCOUNTINGDATE AS [Accounting date], 
		  dbo.GENERALJOURNALENTRY.CREATEDDATETIME AS [Created date], 
                  dbo.GENERALJOURNALENTRY.CREATEDBY AS [Created by], 
				  dbo.GENERALJOURNALACCOUNTENTRY.TRANSACTIONCURRENCYCODE AS Currency, 
				  dbo.LEDGER.ACCOUNTINGCURRENCY AS [Legal entity currency], 
                  (CASE WHEN dbo.GENERALJOURNALACCOUNTENTRY.ACCOUNTINGCURRENCYAMOUNT = 0 OR
                  dbo.GENERALJOURNALACCOUNTENTRY.TRANSACTIONCURRENCYAMOUNT = 0 THEN 0 ELSE dbo.GENERALJOURNALACCOUNTENTRY.ACCOUNTINGCURRENCYAMOUNT / dbo.GENERALJOURNALACCOUNTENTRY.TRANSACTIONCURRENCYAMOUNT * 100 END) 
                  AS [Exchange rate], dbo.GENERALJOURNALACCOUNTENTRY.TRANSACTIONCURRENCYAMOUNT AS [Amount transaction currency], dbo.GENERALJOURNALACCOUNTENTRY.ACCOUNTINGCURRENCYAMOUNT AS [Amount accounting currency], 
                  DIM1.DISPLAYVALUE AS Account, DIM2.DISPLAYVALUE AS Stores, DIM3.DISPLAYVALUE AS Department, DIM4.DISPLAYVALUE AS Cost, DIM5.DISPLAYVALUE AS Project, DIM6.DISPLAYVALUE AS [Bank account], DIM7.DISPLAYVALUE AS Site, 
				  DIM8.DISPLAYVALUE AS ICDim, 
                  dbo.GENERALJOURNALENTRY.POSTINGLAYER AS [Posting layer],
				  
				  case dbo.generalJournalEntry.JournalCategory
					when 14 then '14 vendor'
					when 15 then '15 payment'
					when 36 then '36 general journal'
					else '<unknown>'
				  end as TransType,
				  GENERALJOURNALACCOUNTENTRY.TEXT as 'Text',
				  GENERALJOURNALACCOUNTENTRY.LEDGERDIMENSION

FROM        dbo.LEDGERENTRYJOURNAL FULL OUTER JOIN
                  dbo.GENERALJOURNALACCOUNTENTRY INNER JOIN
                  dbo.GENERALJOURNALENTRY ON dbo.GENERALJOURNALENTRY.RECID = dbo.GENERALJOURNALACCOUNTENTRY.GENERALJOURNALENTRY INNER JOIN
                  dbo.SUBLEDGERVOUCHERGENERALJOURNALENTRY ON dbo.SUBLEDGERVOUCHERGENERALJOURNALENTRY.GENERALJOURNALENTRY = dbo.GENERALJOURNALENTRY.RECID INNER JOIN
                  dbo.LEDGER ON dbo.SUBLEDGERVOUCHERGENERALJOURNALENTRY.VOUCHERDATAAREAID = dbo.LEDGER.NAME LEFT OUTER JOIN

                      (SELECT     dbo.DIMENSIONATTRIBUTELEVELVALUEVIEW.VALUECOMBINATIONRECID, dbo.DIMENSIONATTRIBUTELEVELVALUEVIEW.DISPLAYVALUE
                       FROM        dbo.DIMENSIONATTRIBUTELEVELVALUEVIEW INNER JOIN
                                         dbo.DIMENSIONATTRIBUTE ON dbo.DIMENSIONATTRIBUTELEVELVALUEVIEW.DIMENSIONATTRIBUTE = dbo.DIMENSIONATTRIBUTE.RECID
                       WHERE     (dbo.DIMENSIONATTRIBUTE.NAME = 'MainAccount')) AS DIM1 ON dbo.GENERALJOURNALACCOUNTENTRY.LEDGERDIMENSION = DIM1.VALUECOMBINATIONRECID LEFT OUTER JOIN

                      (SELECT     DIMENSIONATTRIBUTELEVELVALUEVIEW_1.VALUECOMBINATIONRECID, DIMENSIONATTRIBUTELEVELVALUEVIEW_1.DISPLAYVALUE
                       FROM        dbo.DIMENSIONATTRIBUTELEVELVALUEVIEW AS DIMENSIONATTRIBUTELEVELVALUEVIEW_1 INNER JOIN
                                         dbo.DIMENSIONATTRIBUTE AS DIMENSIONATTRIBUTE_1 ON DIMENSIONATTRIBUTELEVELVALUEVIEW_1.DIMENSIONATTRIBUTE = DIMENSIONATTRIBUTE_1.RECID
                       WHERE     (DIMENSIONATTRIBUTE_1.NAME = 'Stores')) AS DIM2 ON dbo.GENERALJOURNALACCOUNTENTRY.LEDGERDIMENSION = DIM2.VALUECOMBINATIONRECID LEFT OUTER JOIN

                      (SELECT     DIMENSIONATTRIBUTELEVELVALUEVIEW_2.VALUECOMBINATIONRECID, DIMENSIONATTRIBUTELEVELVALUEVIEW_2.DISPLAYVALUE
                       FROM        dbo.DIMENSIONATTRIBUTELEVELVALUEVIEW AS DIMENSIONATTRIBUTELEVELVALUEVIEW_2 INNER JOIN
                                         dbo.DIMENSIONATTRIBUTE AS DIMENSIONATTRIBUTE_2 ON DIMENSIONATTRIBUTELEVELVALUEVIEW_2.DIMENSIONATTRIBUTE = DIMENSIONATTRIBUTE_2.RECID
                       WHERE     (DIMENSIONATTRIBUTE_2.NAME = 'Department')) AS DIM3 ON dbo.GENERALJOURNALACCOUNTENTRY.LEDGERDIMENSION = DIM3.VALUECOMBINATIONRECID LEFT OUTER JOIN

                      (SELECT     DIMENSIONATTRIBUTELEVELVALUEVIEW_3.VALUECOMBINATIONRECID, DIMENSIONATTRIBUTELEVELVALUEVIEW_3.DISPLAYVALUE
                       FROM        dbo.DIMENSIONATTRIBUTELEVELVALUEVIEW AS DIMENSIONATTRIBUTELEVELVALUEVIEW_3 INNER JOIN
                                         dbo.DIMENSIONATTRIBUTE AS DIMENSIONATTRIBUTE_3 ON DIMENSIONATTRIBUTELEVELVALUEVIEW_3.DIMENSIONATTRIBUTE = DIMENSIONATTRIBUTE_3.RECID
                       WHERE     (DIMENSIONATTRIBUTE_3.NAME = 'Cost')) AS DIM4 ON dbo.GENERALJOURNALACCOUNTENTRY.LEDGERDIMENSION = DIM4.VALUECOMBINATIONRECID LEFT OUTER JOIN

                      (SELECT     DIMENSIONATTRIBUTELEVELVALUEVIEW_4.VALUECOMBINATIONRECID, DIMENSIONATTRIBUTELEVELVALUEVIEW_4.DISPLAYVALUE
                       FROM        dbo.DIMENSIONATTRIBUTELEVELVALUEVIEW AS DIMENSIONATTRIBUTELEVELVALUEVIEW_4 INNER JOIN
                                         dbo.DIMENSIONATTRIBUTE AS DIMENSIONATTRIBUTE_4 ON DIMENSIONATTRIBUTELEVELVALUEVIEW_4.DIMENSIONATTRIBUTE = DIMENSIONATTRIBUTE_4.RECID
                       WHERE     (DIMENSIONATTRIBUTE_4.NAME = 'Project')) AS DIM5 ON dbo.GENERALJOURNALACCOUNTENTRY.LEDGERDIMENSION = DIM5.VALUECOMBINATIONRECID LEFT OUTER JOIN

                      (SELECT     DIMENSIONATTRIBUTELEVELVALUEVIEW_5.VALUECOMBINATIONRECID, DIMENSIONATTRIBUTELEVELVALUEVIEW_5.DISPLAYVALUE
                       FROM        dbo.DIMENSIONATTRIBUTELEVELVALUEVIEW AS DIMENSIONATTRIBUTELEVELVALUEVIEW_5 INNER JOIN
                                         dbo.DIMENSIONATTRIBUTE AS DIMENSIONATTRIBUTE_5 ON DIMENSIONATTRIBUTELEVELVALUEVIEW_5.DIMENSIONATTRIBUTE = DIMENSIONATTRIBUTE_5.RECID
                       WHERE     (DIMENSIONATTRIBUTE_5.NAME = 'BankAccount')) AS DIM6 ON dbo.GENERALJOURNALACCOUNTENTRY.LEDGERDIMENSION = DIM6.VALUECOMBINATIONRECID LEFT OUTER JOIN

                      (SELECT     DIMENSIONATTRIBUTELEVELVALUEVIEW_6.VALUECOMBINATIONRECID, DIMENSIONATTRIBUTELEVELVALUEVIEW_6.DISPLAYVALUE
                       FROM        dbo.DIMENSIONATTRIBUTELEVELVALUEVIEW AS DIMENSIONATTRIBUTELEVELVALUEVIEW_6 INNER JOIN
                                         dbo.DIMENSIONATTRIBUTE AS DIMENSIONATTRIBUTE_6 ON DIMENSIONATTRIBUTELEVELVALUEVIEW_6.DIMENSIONATTRIBUTE = DIMENSIONATTRIBUTE_6.RECID
                       WHERE     (DIMENSIONATTRIBUTE_6.NAME = 'Site')) AS DIM7 ON dbo.GENERALJOURNALACCOUNTENTRY.LEDGERDIMENSION = DIM7.VALUECOMBINATIONRECID left OUTER JOIN

                      (SELECT     DIMENSIONATTRIBUTELEVELVALUEVIEW_7.VALUECOMBINATIONRECID, DIMENSIONATTRIBUTELEVELVALUEVIEW_7.DISPLAYVALUE
                       FROM        dbo.DIMENSIONATTRIBUTELEVELVALUEVIEW AS DIMENSIONATTRIBUTELEVELVALUEVIEW_7 INNER JOIN
                                         dbo.DIMENSIONATTRIBUTE AS DIMENSIONATTRIBUTE_7 ON DIMENSIONATTRIBUTELEVELVALUEVIEW_7.DIMENSIONATTRIBUTE = DIMENSIONATTRIBUTE_7.RECID
                       WHERE     (DIMENSIONATTRIBUTE_7.NAME = 'ICP')) AS DIM8 ON dbo.GENERALJOURNALACCOUNTENTRY.LEDGERDIMENSION = DIM8.VALUECOMBINATIONRECID left OUTER JOIN

                  dbo.LEDGERENTRY ON dbo.LEDGERENTRY.GENERALJOURNALACCOUNTENTRY = dbo.GENERALJOURNALACCOUNTENTRY.RECID ON dbo.LEDGERENTRYJOURNAL.RECID = dbo.GENERALJOURNALENTRY.LEDGERENTRYJOURNAL FULL OUTER JOIN
                  dbo.LEDGERENTRYJOURNALIZING ON dbo.GENERALJOURNALACCOUNTENTRY.RECID = dbo.LEDGERENTRYJOURNALIZING.GENERALJOURNALACCOUNTENTRY
where DIM1.DISPLAYVALUE = '893101'
--dbo.SUBLEDGERVOUCHERGENERALJOURNALENTRY.VOUCHERDATAAREAID = 'NO01' and
--and   dbo.GENERALJOURNALENTRY.ACCOUNTINGDATE>=DATEADD(MONTH, DATEDIFF(MONTH, '19000101', GETDATE()) - 1, '19000101')
--and   dbo.GENERALJOURNALENTRY.ACCOUNTINGDATE<=DATEADD(D, -1, DATEADD(MONTH, DATEDIFF(MONTH, '19000101', GETDATE()), '19000101'))
GO



